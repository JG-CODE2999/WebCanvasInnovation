{% extends "base.html" %}

{% block title %}Search: {{ query }} | TechBlog{% endblock %}

{% block content %}
<div class="container" id="search-results-page">
  <div class="row">
    <!-- Main Content -->
    <div class="col-lg-8">
      <div class="mb-4">
        <h1><i class="fas fa-search me-2"></i>Search Results</h1>
        <p class="lead">Results for: <strong>"{{ query }}"</strong></p>
      </div>
      
      <div class="search-results-container">
        {% if posts.items %}
          {% for post in posts.items %}
            <div class="card mb-4 shadow-sm fade-in">
              <div class="row g-0">
                {% if post.feature_image %}
                <div class="col-md-4">
                  <img src="{{ post.feature_image }}" class="img-fluid rounded-start h-100 object-fit-cover" alt="{{ post.title }}">
                </div>
                {% endif %}
                <div class="{% if post.feature_image %}col-md-8{% else %}col-12{% endif %}">
                  <div class="card-body">
                    <h2 class="card-title h4">
                      <a href="{{ url_for('post', post_id=post.id) }}" class="text-decoration-none">
                        {{ post.title }}
                      </a>
                    </h2>
                    
                    <!-- Post metadata -->
                    <div class="mb-2 text-muted">
                      <small>
                        <i class="fas fa-user-circle me-1"></i> {{ post.author.username }}
                        <span class="mx-1">â€¢</span>
                        <i class="far fa-calendar me-1"></i> {{ post.created_at.strftime('%B %d, %Y') }}
                      </small>
                    </div>
                    
                    <!-- Categories -->
                    {% if post.categories %}
                    <div class="mb-2">
                      {% for category in post.categories %}
                      <a href="{{ url_for('category', category_id=category.id) }}" class="badge bg-secondary text-decoration-none me-1">
                        {{ category.name }}
                      </a>
                      {% endfor %}
                    </div>
                    {% endif %}
                    
                    <!-- Post summary -->
                    <p class="card-text">
                      {% if post.summary %}
                        {{ post.summary }}
                      {% else %}
                        {{ post.content[:150] ~ '...' if post.content|length > 150 else post.content }}
                      {% endif %}
                    </p>
                    
                    <a href="{{ url_for('post', post_id=post.id) }}" class="btn btn-primary btn-sm">Read More</a>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
          
          <!-- Pagination -->
          {% if posts.pages > 1 %}
          <nav aria-label="Search results pagination">
            <ul class="pagination justify-content-center">
              {% if posts.has_prev %}
              <li class="page-item">
                <a class="page-link" href="{{ url_for('search', q=query, page=posts.prev_num) }}" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
              {% else %}
              <li class="page-item disabled">
                <span class="page-link" aria-hidden="true">&laquo;</span>
              </li>
              {% endif %}
              
              {% for page_num in range(1, posts.pages + 1) %}
              <li class="page-item {% if page_num == posts.page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('search', q=query, page=page_num) }}">{{ page_num }}</a>
              </li>
              {% endfor %}
              
              {% if posts.has_next %}
              <li class="page-item">
                <a class="page-link" href="{{ url_for('search', q=query, page=posts.next_num) }}" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
              {% else %}
              <li class="page-item disabled">
                <span class="page-link" aria-hidden="true">&raquo;</span>
              </li>
              {% endif %}
            </ul>
          </nav>
          {% endif %}
          
        {% else %}
          <div class="alert alert-info">
            <h4 class="alert-heading">No results found!</h4>
            <p>Your search for <strong>"{{ query }}"</strong> did not match any posts.</p>
            <hr>
            <p class="mb-0">Suggestions:</p>
            <ul>
              <li>Make sure all words are spelled correctly.</li>
              <li>Try different keywords.</li>
              <li>Try more general keywords.</li>
            </ul>
          </div>
        {% endif %}
      </div>
    </div>
    
    <!-- Sidebar -->
    <div class="col-lg-4">
      <!-- Search Tips Widget -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-lightbulb me-2"></i>Search Tips
          </h5>
        </div>
        <div class="card-body">
          <ul class="list-unstyled mb-0">
            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Use specific terms for better results</li>
            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>Search is case-insensitive</li>
            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>We search in titles and content</li>
          </ul>
        </div>
      </div>
      
      <!-- Categories Widget -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-tags me-2"></i>Browse by Category
          </h5>
        </div>
        <div class="card-body">
          <div class="d-flex flex-wrap gap-2">
            {% for category in categories %}
            <a href="{{ url_for('category', category_id=category.id) }}" class="badge bg-secondary text-decoration-none">
              {{ category.name }}
            </a>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/search.js') }}"></script>
{% endblock %}
